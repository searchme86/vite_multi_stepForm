/* src/index.css */

@tailwind base;
@tailwind components;
@tailwind utilities;

/* 🎯 뷰포트 크기 정규화 - TailwindCSS Preflight 이후 즉시 적용 */
*,
*::before,
*::after {
  box-sizing: border-box;
}

html {
  width: 100vw;
  height: 100vh;
  overflow-x: hidden;
  overflow-y: auto;
  -webkit-text-size-adjust: 100%;
  -moz-text-size-adjust: 100%;
  text-size-adjust: 100%;
  scroll-behavior: smooth;
}

body {
  width: 100%;
  height: 100%;
  min-height: 100vh;
  min-width: 100vw;
  margin: 0;
  padding: 0;
  overflow-x: hidden;
  overflow-y: auto;
  position: relative;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#root {
  width: 100%;
  height: 100%;
  min-height: 100vh;
  min-width: 100vw;
  margin: 0;
  padding: 0;
  overflow-x: hidden;
  overflow-y: auto;
  position: relative;
  display: flex;
  flex-direction: column;
}

/* 🎯 외부 스크립트 스타일 충돌 방지 */
body * {
  max-width: 100% !important;
}

.heroui-container,
.heroui-wrapper,
[data-heroui-chat],
[data-select-edit] {
  width: 100% !important;
  max-width: 100% !important;
  margin: 0 !important;
  padding: 0 !important;
  overflow-x: hidden !important;
  box-sizing: border-box !important;
}

/* 🎯 최신 뷰포트 단위 지원 */
@supports (height: 100dvh) {
  html {
    height: 100dvh;
  }

  body {
    min-height: 100dvh;
  }

  #root {
    min-height: 100dvh;
  }
}

/* ============================================ */
/* 🎯 데스크탑 오버레이 패널 스타일 (신규 추가) */
/* ============================================ */

@media (min-width: 768px) {
  /* 데스크탑 배경 오버레이 - 🎯 패널과 완벽히 동기화된 부드러운 속도 */
  .preview-panel-desktop-backdrop {
    position: fixed;
    inset: 0;
    z-index: 40;
    background-color: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(4px);
    opacity: 0;
    transition: opacity 800ms ease-out, backdrop-filter 800ms ease-out;
    pointer-events: none;
  }

  .preview-panel-desktop-backdrop.is-visible {
    opacity: 1;
    pointer-events: auto;
  }

  /* 데스크탑 오버레이 패널 - 🎯 매우 부드러운 스무스 애니메이션 */
  .preview-panel-desktop-overlay {
    position: fixed;
    top: 0;
    right: 0;
    z-index: 50;
    width: 600px;
    height: 100vh;
    background-color: white;
    border-left: 1px solid rgb(229, 231, 235); /* border-gray-200 */
    box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1), -4px 0 24px rgba(0, 0, 0, 0.15);

    /* 🎯 매우 부드러운 스무스 애니메이션 */
    transform: translateX(100%);
    transition: transform 1200ms cubic-bezier(0.23, 1, 0.32, 1);

    /* GPU 가속 최적화 */
    will-change: transform;
    backface-visibility: hidden;
  }

  .preview-panel-desktop-overlay.is-open {
    transform: translateX(0);
  }

  /* 데스크탑 패널 헤더 */
  .preview-panel-desktop-header {
    position: sticky;
    top: 0;
    z-index: 10;
    background-color: white;
    border-bottom: 1px solid rgb(229, 231, 235);
    backdrop-filter: blur(8px);
    background-color: rgba(255, 255, 255, 0.95);
  }

  /* 데스크탑 패널 콘텐츠 */
  .preview-panel-desktop-content {
    height: 100%;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: rgb(156, 163, 175) rgb(243, 244, 246);
  }

  .preview-panel-desktop-content::-webkit-scrollbar {
    width: 8px;
  }

  .preview-panel-desktop-content::-webkit-scrollbar-track {
    background: rgb(243, 244, 246);
  }

  .preview-panel-desktop-content::-webkit-scrollbar-thumb {
    background: rgb(156, 163, 175);
    border-radius: 4px;
  }

  .preview-panel-desktop-content::-webkit-scrollbar-thumb:hover {
    background: rgb(107, 114, 128);
  }
}

/* ============================================ */
/* 🎯 모바일 bottom-sheet 패널 스타일 (기존 유지 + 개선) */
/* ============================================ */

@media (max-width: 767px) {
  /* 바디 스크롤 방지 (패널 열렸을 때) */
  body.preview-panel-open {
    overflow: hidden;
    position: fixed;
    width: 100%;
    height: 100%;
  }

  /* 모바일 배경 오버레이 - 🎯 패널과 완벽히 동기화된 부드러운 속도 */
  .preview-panel-mobile-backdrop {
    position: fixed;
    inset: 0;
    z-index: 40;
    background-color: rgba(0, 0, 0, 0.5);
    opacity: 0;
    transition: opacity 900ms ease-out;
    pointer-events: none;
  }

  .preview-panel-mobile-backdrop.is-visible {
    opacity: 1;
    pointer-events: auto;
  }

  /* bottom-sheet 패널 - 🎯 매우 부드러운 스무스 애니메이션 */
  .preview-panel-bottom-sheet {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 50;
    height: 85vh;
    background-color: white;
    border-top-left-radius: 24px;
    border-top-right-radius: 24px;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);

    /* 🎯 매우 부드러운 스무스 애니메이션 */
    transform: translateY(100%);
    transition: transform 1300ms cubic-bezier(0.23, 1, 0.32, 1);

    /* GPU 가속 최적화 */
    will-change: transform;
    backface-visibility: hidden;
  }

  .preview-panel-bottom-sheet.is-open {
    transform: translateY(0);
  }

  /* 드래그 핸들 스타일링 - 🎯 매우 부드러운 애니메이션 */
  .preview-panel-drag-handle {
    width: 48px;
    height: 4px;
    background-color: rgba(0, 0, 0, 0.15);
    border-radius: 2px;
    margin: 12px auto 8px;
    cursor: grab;
    transition: all 600ms ease-out;
  }

  .preview-panel-drag-handle:hover {
    background-color: rgba(0, 0, 0, 0.25);
    transform: scaleX(1.1);
  }

  .preview-panel-drag-handle:active {
    cursor: grabbing;
    background-color: rgba(0, 0, 0, 0.3);
    transform: scaleX(0.9) scaleY(1.2);
  }

  /* 모바일 패널 헤더 */
  .preview-panel-mobile-header {
    position: sticky;
    top: 0;
    z-index: 10;
    background-color: white;
    border-top-left-radius: 24px;
    border-top-right-radius: 24px;
    backdrop-filter: blur(10px);
    background-color: rgba(255, 255, 255, 0.95);
  }

  /* 모바일 패널 콘텐츠 */
  .preview-panel-mobile-content {
    height: calc(85vh - 80px); /* 헤더 높이 제외 */
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
  }

  .preview-panel-mobile-content::-webkit-scrollbar {
    width: 6px;
  }

  .preview-panel-mobile-content::-webkit-scrollbar-track {
    background: rgb(243, 244, 246);
  }

  .preview-panel-mobile-content::-webkit-scrollbar-thumb {
    background: rgb(156, 163, 175);
    border-radius: 3px;
  }

  .preview-panel-mobile-content::-webkit-scrollbar-thumb:hover {
    background: rgb(107, 114, 128);
  }

  /* 스와이프 인터랙션 상태 - 🎯 매우 부드러운 스냅 백 */
  .preview-panel-bottom-sheet.swiping {
    transition: none;
  }

  .preview-panel-bottom-sheet.snapping {
    transition: transform 600ms cubic-bezier(0.23, 1, 0.32, 1);
  }

  /* 안전 영역 고려 (노치가 있는 디바이스) */
  @supports (padding-bottom: env(safe-area-inset-bottom)) {
    .preview-panel-bottom-sheet {
      padding-bottom: env(safe-area-inset-bottom);
      height: calc(85vh + env(safe-area-inset-bottom));
    }
  }
}

/* ============================================ */
/* 🎯 공통 애니메이션 및 트랜지션 */
/* ============================================ */

/* 상태 표시기 애니메이션 - 🎯 더욱 부드러운 진입 */
.preview-panel-status-indicator {
  animation: slideInFromTop 700ms cubic-bezier(0.23, 1, 0.32, 1) 400ms both;
}

@keyframes slideInFromTop {
  from {
    opacity: 0;
    transform: translateY(-16px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* 콘텐츠 페이드인 애니메이션 - 🎯 패널 열림 후 충분한 지연과 부드러운 등장 */
.preview-panel-content-fade {
  animation: fadeInUp 800ms cubic-bezier(0.23, 1, 0.32, 1) 600ms both;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(24px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* 부드러운 페이드 효과 - 🎯 매우 자연스러운 타이밍 */
.preview-panel-content-smooth {
  animation: slideUpIn 700ms ease-out 500ms both;
}

@keyframes slideUpIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ============================================ */
/* 🎯 기존 스타일 유지 (호환성) */
/* ============================================ */

/* 🎯 모바일 최적화 */
@media (max-width: 768px) {
  body {
    -webkit-overflow-scrolling: touch;
  }

  #root {
    touch-action: pan-y;
  }
}

/* 데스크탑에서 PreviewPanel 스티키 포지션 (기존 방식 - 현재는 사용 안함) */
@media (min-width: 768px) {
  .preview-panel-desktop {
    position: sticky;
    top: 20px;
    max-height: calc(100vh - 40px);
    overflow-y: auto;
    will-change: scroll-position;
  }
}

/* 세로 쓰기 버튼 스타일 개선 (BlogMediaStep.tsx의 미리보기 버튼용) */
button[writing-mode='vertical-rl'] {
  writing-mode: vertical-rl;
  text-orientation: mixed;
  letter-spacing: 2px;
  transition: all 0.2s ease-in-out;
}

/* 미리보기 토글 버튼 호버 효과 개선 */
button[aria-label='미리보기 패널 토글']:hover {
  transform: translateX(-4px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* 미리보기 토글 버튼 액티브 효과 */
button[aria-label='미리보기 패널 토글']:active {
  transform: translateX(-2px) scale(0.98);
}

/* ============================================ */
/* 🎯 접근성 및 성능 최적화 */
/* ============================================ */

/* 성능 최적화를 위한 reduced-motion 지원 - 🎯 접근성 고려한 부드러운 단축 버전 */
@media (prefers-reduced-motion: reduce) {
  .preview-panel-desktop-overlay,
  .preview-panel-bottom-sheet,
  .preview-panel-desktop-backdrop,
  .preview-panel-mobile-backdrop,
  .preview-panel-drag-handle,
  .preview-panel-status-indicator,
  .preview-panel-content-fade,
  .preview-panel-content-smooth {
    animation: none !important;
    transition: transform 400ms ease-out, opacity 400ms ease-out !important;
  }

  .preview-panel-desktop-overlay.is-open {
    transform: translateX(0);
  }

  .preview-panel-bottom-sheet.is-open {
    transform: translateY(0);
  }

  .preview-panel-desktop-backdrop.is-visible,
  .preview-panel-mobile-backdrop.is-visible {
    opacity: 1;
    backdrop-filter: blur(4px);
  }
}

/* ============================================ */
/* 🎯 다크모드 지원 (선택사항) */
/* ============================================ */

@media (prefers-color-scheme: dark) {
  /* 데스크탑 다크모드 */
  @media (min-width: 768px) {
    .preview-panel-desktop-overlay {
      background-color: rgb(26, 26, 26);
      border-left-color: rgb(64, 64, 64);
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.3), -4px 0 24px rgba(0, 0, 0, 0.4);
    }

    .preview-panel-desktop-header {
      background-color: rgba(26, 26, 26, 0.95);
      border-bottom-color: rgb(64, 64, 64);
    }

    .preview-panel-desktop-content::-webkit-scrollbar-track {
      background: rgb(64, 64, 64);
    }

    .preview-panel-desktop-content::-webkit-scrollbar-thumb {
      background: rgb(156, 163, 175);
    }

    .preview-panel-desktop-content::-webkit-scrollbar-thumb:hover {
      background: rgb(209, 213, 219);
    }
  }

  /* 모바일 다크모드 */
  @media (max-width: 767px) {
    .preview-panel-bottom-sheet {
      background-color: rgb(26, 26, 26);
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
    }

    .preview-panel-drag-handle {
      background-color: rgba(255, 255, 255, 0.2);
    }

    .preview-panel-drag-handle:hover {
      background-color: rgba(255, 255, 255, 0.3);
    }

    .preview-panel-drag-handle:active {
      background-color: rgba(255, 255, 255, 0.4);
    }

    .preview-panel-mobile-header {
      background-color: rgba(26, 26, 26, 0.95);
    }

    .preview-panel-mobile-content::-webkit-scrollbar-track {
      background: rgb(64, 64, 64);
    }

    .preview-panel-mobile-content::-webkit-scrollbar-thumb {
      background: rgb(156, 163, 175);
    }

    .preview-panel-mobile-content::-webkit-scrollbar-thumb:hover {
      background: rgb(209, 213, 219);
    }
  }

  /* 배경 오버레이 다크모드 */
  .preview-panel-desktop-backdrop {
    background-color: rgba(0, 0, 0, 0.5);
  }

  .preview-panel-mobile-backdrop {
    background-color: rgba(0, 0, 0, 0.7);
  }
}

/* ============================================ */
/* 🎯 유틸리티 클래스 */
/* ============================================ */

/* Tailwind 유틸리티 클래스 보완 */
.hide-scrollbar {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

.hide-scrollbar::-webkit-scrollbar {
  display: none;
}

/* 고해상도 디스플레이 최적화 */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  .preview-panel-desktop-overlay {
    box-shadow: -1px 0 4px rgba(0, 0, 0, 0.1), -2px 0 8px rgba(0, 0, 0, 0.1),
      -4px 0 16px rgba(0, 0, 0, 0.15);
  }

  .preview-panel-bottom-sheet {
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1), 0 -4px 20px rgba(0, 0, 0, 0.15);
  }
}

/* 반응형 브레이크포인트 조정 */
@media (min-width: 768px) and (max-width: 1023px) {
  /* 태블릿 최적화 */
  .preview-panel-desktop-overlay {
    width: 450px;
  }
}

@media (min-width: 1024px) and (max-width: 1279px) {
  /* 작은 데스크탑 최적화 */
  .preview-panel-desktop-overlay {
    width: 550px;
  }
}

@media (min-width: 1280px) {
  /* 큰 데스크탑 최적화 */
  .preview-panel-desktop-overlay {
    width: 650px;
  }
}
