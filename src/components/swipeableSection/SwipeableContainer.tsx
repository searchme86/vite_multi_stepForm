import React from 'react';
import { Swiper, SwiperSlide } from 'swiper/react';
import { Navigation, Pagination } from 'swiper/modules';
import {
  SwipeableContainerProps,
  SwipeableConfig,
} from './types/swipeableTypes';

import 'swiper/css';
import 'swiper/css/navigation';
import 'swiper/css/pagination';

/**
 * config ê°ì²´ë¥¼ Swiper propsë¡œ ìë™ ë³€í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
 * - ì‚¬ìš©ì ì¹œí™”ì ì¸ ì„¤ì •ì„ Swiper ë‚´ë¶€ ì„¤ì •ìœ¼ë¡œ ë§¤í•‘
 * - íƒ€ì… ì•ˆì „ì„± ë³´ì¥ ë° ê¸°ë³¸ê°’ ìë™ ì ìš©
 */
function configToSwiperProps(config: SwipeableConfig = {}) {
  // ê¸°ë³¸ ëª¨ë“ˆ ì„¤ì • - í•„ìš”ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ì¶”ê°€
  const modules = [];
  if (config.showNavigation) {
    modules.push(Navigation); // í™”ì‚´í‘œ ë„¤ë¹„ê²Œì´ì…˜ ëª¨ë“ˆ ì¶”ê°€
  }
  if (config.showPagination) {
    modules.push(Pagination); // í˜ì´ì§€ë„¤ì´ì…˜ ëª¨ë“ˆ ì¶”ê°€
  }

  // config ê°’ë“¤ì„ Swiper propsë¡œ ë³€í™˜
  return {
    modules, // ë™ì ìœ¼ë¡œ êµ¬ì„±ëœ ëª¨ë“ˆ ë°°ì—´

    // ê¸°ë³¸ ìŠ¬ë¼ì´ë“œ ì„¤ì •
    slidesPerView: 1, // í•œ ë²ˆì— ë³´ì—¬ì¤„ ìŠ¬ë¼ì´ë“œ ìˆ˜
    spaceBetween: config.spaceBetween || 0, // ìŠ¬ë¼ì´ë“œ ê°„ ê°„ê²©

    // í„°ì¹˜/ë“œë˜ê·¸ ë™ì‘ ì„¤ì •
    allowTouchMove: config.touchEnabled !== false, // í„°ì¹˜ ì´ë™ í—ˆìš© (ê¸°ë³¸: true)
    touchRatio: 1, // í„°ì¹˜ ê°ë„
    touchAngle: 45, // í„°ì¹˜ ê°ë„ ì„ê³„ê°’

    // ì• ë‹ˆë©”ì´ì…˜ ì„¤ì •
    speed: config.speed || 300, // ì „í™˜ ì†ë„ (ë°€ë¦¬ì´ˆ)
    effect: 'slide' as const, // ì „í™˜ íš¨ê³¼ íƒ€ì…

    // ë£¨í”„ ë° ì´ˆê¸° ì„¤ì •
    loop: config.allowLoop || false, // ë¬´í•œ ë£¨í”„ í—ˆìš©
    initialSlide: config.initialSlide || 0, // ì´ˆê¸° ìŠ¬ë¼ì´ë“œ ì¸ë±ìŠ¤

    // ìë™ ì¬ìƒ ì„¤ì •
    autoplay: config.autoplay
      ? {
          delay: typeof config.autoplay === 'number' ? config.autoplay : 3000, // ìë™ ì¬ìƒ ê°„ê²©
          disableOnInteraction: true, // ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ì‹œ ì¼ì‹œì •ì§€
          pauseOnMouseEnter: true, // ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ì¼ì‹œì •ì§€
        }
      : false,

    // ë„¤ë¹„ê²Œì´ì…˜ UI ì„¤ì •
    navigation: config.showNavigation
      ? {
          nextEl: '.swiper-button-next', // ë‹¤ìŒ ë²„íŠ¼ ì„ íƒì
          prevEl: '.swiper-button-prev', // ì´ì „ ë²„íŠ¼ ì„ íƒì
        }
      : false,

    pagination: config.showPagination
      ? {
          el: '.swiper-pagination', // í˜ì´ì§€ë„¤ì´ì…˜ ì»¨í…Œì´ë„ˆ ì„ íƒì
          clickable: true, // í´ë¦­ ê°€ëŠ¥í•œ í˜ì´ì§€ë„¤ì´ì…˜
          type: 'bullets' as const, // ë¶ˆë¦¿ íƒ€ì… í˜ì´ì§€ë„¤ì´ì…˜
        }
      : false,

    // ë°˜ì‘í˜• ì„¤ì •
    breakpoints: {
      0: {
        allowTouchMove: true, // ëª¨ë°”ì¼ì—ì„œ í„°ì¹˜ í—ˆìš©
        touchRatio: 1.2, // ëª¨ë°”ì¼ í„°ì¹˜ ê°ë„ ì¦ê°€
      },
      768: {
        allowTouchMove: true, // íƒœë¸”ë¦¿ì—ì„œ í„°ì¹˜ í—ˆìš©
        touchRatio: 0.8, // íƒœë¸”ë¦¿ í„°ì¹˜ ê°ë„ ì¡°ì •
      },
      1024: {
        allowTouchMove: true, // ë°ìŠ¤í¬í†±ì—ì„œë„ í„°ì¹˜ í—ˆìš©
        touchRatio: 0.6, // ë°ìŠ¤í¬í†± í„°ì¹˜ ê°ë„ ê°ì†Œ
      },
    },
  };
}

/**
 * SwipeableContainer ë©”ì¸ ì»´í¬ë„ŒíŠ¸
 * - React.Children.mapìœ¼ë¡œ childrenì„ ì•ˆì „í•˜ê²Œ ìˆœíšŒ
 * - config ê°ì²´ë¥¼ Swiper propsë¡œ ìë™ ë³€í™˜
 * - Swiper ê¸°ë³¸ ê¸°ëŠ¥ì— ì¶©ì‹¤í•œ ë‹¨ìˆœí•œ êµ¬ì¡°
 * - ì›¹ì ‘ê·¼ì„± ë° ë°˜ì‘í˜• ë””ìì¸ ì§€ì›
 */
export function SwipeableContainer({
  config = {}, // ê¸°ë³¸ê°’ìœ¼ë¡œ ë¹ˆ ê°ì²´ ì œê³µ
  children,
  className = '',
  onSlideChange,
  swiperProps = {}, // ì¶”ê°€ Swiper ì„¤ì •
}: SwipeableContainerProps) {
  console.log('SwipeableContainer ë Œë”ë§:', {
    configProvided: !!config,
    childrenCount: React.Children.count(children),
    hasCustomProps: Object.keys(swiperProps).length > 0,
  });

  // configë¥¼ Swiper propsë¡œ ë³€í™˜
  const autoGeneratedProps = configToSwiperProps(config);

  // ìµœì¢… Swiper ì„¤ì • (ì‚¬ìš©ì ì •ì˜ propsê°€ ìš°ì„ ìˆœìœ„)
  const finalSwiperProps = {
    ...autoGeneratedProps, // configì—ì„œ ìë™ ìƒì„±ëœ props
    ...swiperProps, // ì‚¬ìš©ìê°€ ì§ì ‘ ì „ë‹¬í•œ props (ìš°ì„ ìˆœìœ„ ë†’ìŒ)

    // ìŠ¬ë¼ì´ë“œ ë³€ê²½ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
    onSlideChange: (swiper: any) => {
      console.log('ìŠ¬ë¼ì´ë“œ ë³€ê²½ë¨:', swiper.activeIndex);
      onSlideChange?.(swiper); // ì‚¬ìš©ì ì½œë°± í˜¸ì¶œ
    },
  };

  // ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ í´ë˜ìŠ¤
  const containerClass = `
    relative w-full h-full
    overflow-hidden
    bg-gray-50/50
    ${className}
  `.trim();

  return (
    <div
      className={containerClass}
      role="region" // ì›¹ì ‘ê·¼ì„±: ë…ë¦½ì ì¸ ì½˜í…ì¸  ì˜ì—­
      aria-label="ìŠ¬ë¼ì´ë“œ ì½˜í…ì¸ " // ì›¹ì ‘ê·¼ì„±: ì˜ì—­ ì„¤ëª…
      data-swipeable-container="true" // ë””ë²„ê¹…ìš© ë°ì´í„° ì†ì„±
      data-total-slides={React.Children.count(children)} // ë””ë²„ê¹…ìš©: ì´ ìŠ¬ë¼ì´ë“œ ìˆ˜
    >
      {/* Swiper ì»´í¬ë„ŒíŠ¸ */}
      <Swiper {...finalSwiperProps}>
        {/* React.Children.mapìœ¼ë¡œ ê° childë¥¼ SwiperSlideë¡œ ê°ì‹¸ê¸° */}
        {React.Children.map(children, (child, index) => {
          console.log(`ìŠ¬ë¼ì´ë“œ ${index} ë Œë”ë§ ì¤‘`);

          return (
            <SwiperSlide
              key={`slide-${index}`}
              className="h-full"
              data-slide-index={index}
              role="tabpanel"
              aria-label={`ìŠ¬ë¼ì´ë“œ ${index + 1}`}
            >
              {child}
            </SwiperSlide>
          );
        })}
      </Swiper>
    </div>
  );
}

/**
 * ğŸ¨ SwipeableContainer ì‚¬ìš©ë²• ì˜ˆì‹œ:
 *
 * // 1. ê¸°ë³¸ ì‚¬ìš©ë²• (ì„¤ì • ì—†ìŒ)
 * <SwipeableContainer>
 *   <SwipeSlide>ì½˜í…ì¸  1</SwipeSlide>
 *   <SwipeSlide>ì½˜í…ì¸  2</SwipeSlide>
 * </SwipeableContainer>
 *
 * // 2. ê°„ë‹¨í•œ config ì‚¬ìš©
 * <SwipeableContainer
 *   config={{
 *     speed: 400,
 *     allowLoop: true,
 *     autoplay: 3000,
 *     showNavigation: true,
 *     showPagination: true
 *   }}
 * >
 *   <SwipeSlide slideId="slide1">
 *     <CustomComponent1 />
 *   </SwipeSlide>
 *   <SwipeSlide slideId="slide2">
 *     <CustomComponent2 />
 *   </SwipeSlide>
 * </SwipeableContainer>
 *
 * // 3. ê³ ê¸‰ ì‚¬ìš©ë²• (ì§ì ‘ Swiper props ì „ë‹¬)
 * <SwipeableContainer
 *   config={{ speed: 500 }}
 *   swiperProps={{
 *     centeredSlides: true,
 *     coverflowEffect: { rotate: 30 }
 *   }}
 *   onSlideChange={(swiper) => console.log('í˜„ì¬ ìŠ¬ë¼ì´ë“œ:', swiper.activeIndex)}
 * >
 *   <SwipeSlide>ë‚´ìš©</SwipeSlide>
 * </SwipeableContainer>
 */
